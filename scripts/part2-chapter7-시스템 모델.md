# Chapter7. 시스템 모델
시스템 모델은 문제를 수학식으로 표현해 놓은 것을 말한다. 각 분야에서 참고할 만한 칼만 필터의 시스템 모델을 찾을 수 있으나, 그렇지 않다면 선형 시스템과 시스템 모델을 공부해야 한다.

## 7.1. 시스템 모델
칼만 필터는 아래와 같은 선형(linear) 상태 모델(state model)을 갖는다. 아래 식에는 시스템 모델의 잡음이 포함되어 있어야 한다. 모든 잡음을 백색 잡음(white noise, 모든 주파수 정분을 전부 가지고 있는 잡음)이라 가정한다.

$$
\begin{aligned}
x_{k+1} &= A x_k + w_k \qquad & \cdots ⓐ \\
z_{k} &= H x_k + v_k \qquad & \cdots ⓑ
\end{aligned}
$$

|변수|의미|형태|
|---|---|---|
| $x_k$ | 상태 변수(state variable): 물리적 변수(거리, 속도 등) | (n x 1) 열벡터 |
| $z_k$ | 측정값 | (m x 1) 열벡터 |
| $A$ | 시스템 행렬: 시간에 따라 시스템이 어떻게 움직이는가. 시스템의 운동 방정식 | (n x n) 상수 행렬 |
| $H$ | 출력 행렬: 측정값에 각 상태변수가 반영되는 양상(관계) | (m x n) 상수 행렬 |
| $w_k$ | 시스템 잡음: 시스템에 유입되어 상태 변수에 영향을 줌 | (n x 1) 열벡터 |
| $v_k$ | 측정 잡음: 센서에 유입됨 | (m x 1) 열벡터 |

상태 공간 모델(state space model)이란, 위 식 ⓐ, ⓑ와 같이 시스템의 운동 방정식을 상태 변수 벡터에 대해 1차 차분(미분) 방적식으로 표현한 것이다.

1단계인 예측 과정에서 식 $\hat{x}_{k+1}^- = A \hat{x}_k$가 그러하고, 3단계인 추정 과정에서 $\hat{x}_k = \hat{x}_{k}^- + K_k(z_k - H \hat{x}_k^-)$의 $ H \hat{x}_k^-$가 그러하다.

## 7.2. 잡음의 공분산
보통 잡음은 예측이 아닌 통계적 추정만 가능하여 통계학을 이용하나, 칼만 필터에서는 잡음이 평균이 0인 정규 분포를 따른다고 가정하므로 분산만 알면 된다. 따라서 칼만 필터의 상태 모델 잡음은 아래와 같은 공분산 행렬이다.

|기호|의미|형태|
|---|---|---|
| $Q$ | $w_k$의 공분산 행렬 | (n x n) 대각 행렬 |
| $R$ | $v_k$의 공분산 행렬 | (m x m) 대각 행렬 |

공분산 행렬은 변수의 분산으로 구성된 행렬이다. 잡음 $w_k$가 있고 각 분산 $\sigma_k^2$이 있다고 할 때 공분산 행렬은 아래와 같다. R의 경우도 마찬가지이다.

$$
Q = 
\begin{bmatrix}
\sigma _1^2 & 0 & \cdots & 0 \\
0 & \sigma _2^2 & \cdots & 0 \\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & \cdots & \sigma _n^2 \\
\end{bmatrix}
$$

Q, R은 잡음의 특성을 정확히 반영해야 하나 워낙 복합적이기 때문에 해당 시스템에 대한 경험을 바탕으로 여러 번 시도해봐야 한다. 